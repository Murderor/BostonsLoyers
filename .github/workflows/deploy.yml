name: üöÄ Deploy with Discord Webhook

on:
  push:
    branches: [ "main", "master", "TEST" ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì¶ Checkout
        uses: actions/checkout@v4
      
      - name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–∞
        run: |
          if [ -z "${{ secrets.DISCORD_WEBHOOK_URL }}" ]; then
            echo "‚ùå DISCORD_WEBHOOK_URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!"
            echo "üëâ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Secrets ‚Üí Actions"
            echo "üëâ –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç DISCORD_WEBHOOK_URL"
            echo "üëâ –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à Discord webhook URL"
            exit 1
          fi
          echo "‚úÖ Discord webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
      
      - name: üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ discord-config.js
        run: |
          echo "–°–æ–∑–¥–∞–µ–º discord-config.js —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤–µ–±—Ö—É–∫–æ–º..."
          
          cat > discord-config.js << 'EOF'
          // ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ GitHub Actions
          // ‚ö†Ô∏è –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –µ–≥–æ –≤ git!
          // ‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–π –≤–µ–±—Ö—É–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å
          
          const DISCORD_WEBHOOK_URL_URL = "${{ secrets.DISCORD_WEBHOOK_URL }}";
          const DISCORD_CONFIG = {
              webhook: "${{ secrets.DISCORD_WEBHOOK_URL }}",
              version: "1.0",
              buildDate: "$(date '+%Y-%m-%d %H:%M:%S')",
              buildId: "${{ github.run_id }}",
              roles: {
                  main: "<@&1321503127987421316>",
                  secondary: "<@&1321503135302291516>",
                  tertiary: "<@&1371785937180426270>"
              },
              embeds: {
                  questionColor: 0x3498db,
                  successColor: 0x2ecc71,
                  errorColor: 0xe74c3c,
                  warningColor: 0xf39c12
              }
          };
          
          console.log("‚úÖ Discord Config –∑–∞–≥—Ä—É–∂–µ–Ω (–≤–µ—Ä—Å–∏—è " + DISCORD_CONFIG.version + ")");
          console.log("üìÖ –°–±–æ—Ä–∫–∞: " + DISCORD_CONFIG.buildDate);
          
          if (typeof window !== 'undefined') {
              window.DISCORD_CONFIG = DISCORD_CONFIG;
              window.DISCORD_WEBHOOK_URL_URL = DISCORD_WEBHOOK_URL_URL;
          }
          EOF
          
          echo "‚úÖ discord-config.js —Å–æ–∑–¥–∞–Ω"
          echo "üìÑ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(wc -c discord-config.js | cut -d' ' -f1) –±–∞–π—Ç"
      
      - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          commit_message: "üöÄ Deploy: –û–±–Ω–æ–≤–ª–µ–Ω discord-config.js"
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
      
      - name: üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–ø–ª–æ–µ
        if: success()
        run: |
          echo "üéâ –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
          echo "üåê –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:"
          echo "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
